import type { Metadata } from "next";
import { Inter } from "next/font/google";
import { headers } from "next/headers";

import { Provider as ChakraProvider } from "./ChakraProvider";
import StoreProvider from "./StoreProvider";
import Header from "./components/Header";

import "./globals.css";

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: "Movie Rating",
  description: "Generated by create next app",
};

export default async function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  const headersList = headers();
  const host = headersList.get("host");
  const protocol = headersList.get("x-forwarded-proto") || "http";
  let data = [];
  try {
    let res = await fetch(`${protocol}://${host}/mocks/movies.json`);
    data = await res.json();
  } catch (e) {
    console.log(e);
  }

  return (
    <html lang="en">
      <body className={inter.className}>
        <StoreProvider movies={data}>
          <ChakraProvider>
            <main className="sm:w-[1080px] w-full mx-auto">
              <Header />
              {children}
            </main>
          </ChakraProvider>
        </StoreProvider>
      </body>
    </html>
  );
}
